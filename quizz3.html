<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Questionnaire BDI‑II</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 30px;
      background-color: #54A9AE;
      text-align: center;
      color: #2c3e50;
    }
    h1 {
      margin-bottom: 40px;
      font-size: 32px;
    }
    .identifiant {
      background: #e0e0e0;
      padding: 15px 25px;
      border-radius: 12px;
      text-align: left;
      max-width: 900px;
      margin: 0 auto 30px;
    }
    .identifiant label { font-weight: bold; }
    .identifiant input {
      width: 300px;
      padding: 8px;
      margin-top: 5px;
    }
    .instruction {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 25px 30px;
      margin: 30px auto;
      max-width: 900px;
      text-align: left;
    }
    .question {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 25px 30px;
      margin: 30px auto;
      max-width: 900px;
      text-align: left;
      transition: transform 0.2s ease;
    }
    .question:hover { transform: scale(1.01); }
    .question p {
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 10px;
    }
    label {
      display: block;
      margin: 5px 0;
      font-size: 15px;
      cursor: pointer;
    }
    input[type="radio"] { margin-right: 6px; }
    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 30px;
      transition: background-color 0.3s ease;
    }
    button:hover { background-color: #2980b9; }
  </style>
</head>
<body>
  <h1>Questionnaire BDI‑II</h1>

  <div class="identifiant">
    <label for="identifiant">Identifiant Patient :</label>
    <input type="text" id="identifiant" placeholder="Ex : ABC456">
  </div>

  <div class="instruction">
    <p>Ce questionnaire comporte 21 groupes d’énoncés. Choisissez l’énoncé qui décrit le mieux comment vous vous êtes senti(e) au cours des 2 semaines précédentes, incluant aujourd’hui.</p>
  </div>

  <form id="bdiForm">
    <div id="questions"></div>
    <button type="button" onclick="generateCSV()">Télécharger en CSV</button>
  </form>

  <script>
    const questions = [
      ["Tristesse", ["Je ne me sens pas triste.",
                     "Je me sens très souvent triste.",
                     "Je suis tout le temps triste.",
                     "Je suis si triste... insupportable."]],
      // ... autres items inchangés jusqu’à
      ["Sommeil", ["Habitudes de sommeil inchangées.",
                   "Je dors un peu plus ou un peu moins que d’habitude.",
                   "Je dors beaucoup plus ou beaucoup moins que d’habitude.",
                   "Je dors presque toute la journée / je me réveille trop tôt sans pouvoir me rendormir."]],
      // ...
      ["Appétit", ["Appétit inchangé.",
                   "Un peu plus ou un peu moins d’appétit.",
                   "Beaucoup plus ou beaucoup moins d’appétit.",
                   "Pas d’appétit du tout / je mange sans arrêt."]],
      // ... jusqu’au dernier item
    ];

    const container = document.getElementById('questions');
    questions.forEach(([titre, opts], i) => {
      const q = document.createElement('div');
      q.className = 'question';
      q.innerHTML = `<p>${i+1}. ${titre}</p>` +
        opts.map((txt,j) =>
          `<label><input type="radio" name="q${i}" value="${j}"> ${txt}</label>`
        ).join('');
      container.appendChild(q);
    });

    function generateCSV() {
      const id = document.getElementById("identifiant").value.trim();
      if (!id) {
        alert("Veuillez renseigner l'identifiant patient avant d’exporter.");
        return;
      }

      let csv = "Identifiant;Numéro;Question;Réponse\n";
      questions.forEach(([titre], i) => {
        const rads = document.getElementsByName(`q${i}`);
        let sel = "Non répondu";
        rads.forEach(r => { if (r.checked) sel = r.value; });
        csv += `"${id}";"${i+1}";"${titre}";"${sel}"\n`;
      });

      const blob = new Blob(["\uFEFF"+csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `${id}_BDI-II_resultats.csv`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>
</body>
</html>
