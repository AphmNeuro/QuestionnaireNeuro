<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Questionnaire BDI-II</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 30px;
      background-color: #54A9AE;
      text-align: center;
      color: #2c3e50;
    }
    h1 {
      text-align: center;
      margin-bottom: 40px;
      font-size: 32px;
      color: #2c3e50;
    }
    .identifiant {
      background: #e0e0e0;
      padding: 15px 25px;
      border-radius: 12px;
      text-align: left;
      max-width: 900px;
      margin: 0 auto 30px;
    }
    .identifiant label {
      font-weight: bold;
    }
    .identifiant input {
      width: 300px;
      padding: 8px;
      margin-top: 5px;
    }
    .instruction {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 25px 30px;
      margin: 30px auto;
      max-width: 900px;
      text-align: left;
    }
    .question {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 25px 30px;
      margin: 30px auto;
      max-width: 900px;
      text-align: left;
      transition: transform 0.2s ease;
    }
    .question:hover {
      transform: scale(1.01);
    }
    .question p {
      font-weight: bold;
      margin-bottom: 10px;
      font-size: 16px;
    }
    label {
      display: block;
      margin: 5px 0;
      cursor: pointer;
      font-size: 15px;
    }
    input[type="radio"] {
      margin-right: 6px;
    }
    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 30px;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #2980b9;
    }
  </style>
</head>
<body>
  <h1>Questionnaire BDI-II</h1>

  <div class="identifiant">
    <label for="identifiant">Identifiant Patient :</label>
    <input type="text" id="identifiant" name="identifiant" placeholder="Ex : ABC456">
  </div>

  <div class="instruction">
    <p>Ce questionnaire comporte 21 groupes d'énoncés. Veuillez lire avec soin chacun de ces groupes puis, dans chaque groupe, choisissez l'énoncé qui décrit le mieux comment vous vous êtes senti(e) au cours des deux dernières semaines, incluant aujourd'hui.</p>
  </div>

  <form id="bdiForm">
    <div id="questions"></div>
    <button type="button" onclick="generateCSV()">Télécharger en CSV</button>
  </form>

  <script>
    const questions = [...]; // inchangé

    const container = document.getElementById('questions');
    questions.forEach(([title, options], i) => {
      const div = document.createElement('div');
      div.classList.add('question');
      div.innerHTML = `<p>${i + 1}. ${title}</p>` +
        options.map((opt, j) => `<label><input type="radio" name="q${i}" value="${j}"> ${opt}</label>`).join('');
      container.appendChild(div);
    });

    function generateCSV() {
      const identifiant = document.getElementById("identifiant").value.trim();
      if (!identifiant) {
        alert("Veuillez renseigner l'identifiant patient avant de télécharger les résultats.");
        return;
      }

      let csvContent = "Identifiant;Numéro;Question;Réponse\n";
      questions.forEach(([title, options], i) => {
        const radios = document.getElementsByName(`q${i}`);
        let selected = "Non répondu";
        radios.forEach(r => { if (r.checked) selected = r.value; });
        csvContent += `"${identifiant}";"${i + 1}";"${title}";"${selected}"\n`;
      });

      const BOM = "\uFEFF";
      const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `${identifiant}_BDI-II_resultats.csv`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>
</body>
</html>
