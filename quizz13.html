<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Questionnaire BIS-11</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 30px;
      background-color: #54A9AE;
      text-align: center;
      color: #2c3e50;
    }

    h1 {
      text-align: center;
      margin-bottom: 40px;
      font-size: 32px;
      color: #2c3e50;
    }

    .retour {
      position: absolute;
      top: 20px;
      left: 20px;
    }

    .retour a {
      text-decoration: none;
      color: #ffffff;
      background-color: #2c3e50;
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 14px;
      transition: background-color 0.3s ease;
    }

    .retour a:hover {
      background-color: #1a242f;
    }

    .identifiant {
      background: #e0e0e0;
      padding: 15px 25px;
      border-radius: 12px;
      text-align: left;
      max-width: 900px;
      margin: 0 auto 30px;
    }

    .identifiant label { font-weight: bold; }
    .identifiant input {
      width: 300px;
      padding: 8px;
      margin-top: 5px;
    }

    .instruction {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 25px 30px;
      margin: 30px auto;
      max-width: 900px;
      text-align: left;
    }

    .question-block {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 25px 30px;
      margin: 40px auto;
      max-width: 900px;
      text-align: left;
      transition: transform 0.2s ease;
    }

    .question-block:hover { transform: scale(1.01); }

    .question-block h3 {
      margin-top: 0;
      color: #34495e;
    }

    label {
      display: block;
      margin: 5px 0;
      cursor: pointer;
      font-size: 15px;
    }

    input[type="radio"] { margin-right: 8px; }

    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 30px;
      transition: background-color 0.3s ease;
    }

    button:hover { background-color: #2980b9; }
  </style>
</head>
<body>
  <div class="retour">
    <a href="index.html">← Retour</a>
  </div>

  <h1>Questionnaire BIS-11</h1>

  <div class="identifiant">
    <label for="identifiant">Identifiant Patient :</label>
    <input type="text" id="identifiant" placeholder="Ex : ABC456">
  </div>

  <div class="instruction">
    <h2>Instructions</h2>
    <p>Les gens agissent et réfléchissent différemment devant des situations variées.</p>
    <p>Ce questionnaire a pour but d'évaluer certaines de vos façons d'agir et de réfléchir.</p>
    <p>Lisez chaque énoncé et cochez le cercle approprié à droite de l’affirmation. Répondez vite et honnêtement.</p>
  </div>

  <form id="bisForm">
    <div id="questions"></div>
    <button type="button" onclick="generateCSV()">Télécharger en CSV</button>
  </form>

  <script>
    const questions = [
      "Je prépare soigneusement les tâches à accomplir.",
      "Je fais les choses sans réfléchir.",
      "Je me décide rapidement.",
      "Je suis insouciant.",
      "Je ne fais pas attention.",
      "Mes pensées défilent très vite.",
      "Je programme mes voyages longtemps à l'avance.",
      "Je suis maître de moi.",
      "Je me concentre facilement.",
      "Je mets de l'argent de côté raisonnablement.",
      "Je ne tiens pas en place aux spectacles ou aux conférences.",
      "Je réfléchis soigneusement.",
      "Je veille à ma sécurité d’emploi.",
      "Je dis les choses sans réfléchir.",
      "J'aime réfléchir à des problèmes complexes.",
      "Je change d'emploi.",
      "J'agis sur un coup de tête.",
      "Réfléchir sur un problème m'ennuie vite.",
      "J'agis selon l'inspiration du moment.",
      "Je réfléchis posément.",
      "Je change de logement.",
      "J'achète les choses sur un coup de tête.",
      "Je ne peux penser qu'à un problème à la fois.",
      "Je change de loisir.",
      "Je dépense ou paye à crédit plus que je ne gagne.",
      "Lorsque je réfléchis d’autres pensées me viennent à l’esprit.",
      "Je m'intéresse plus au présent qu'à l'avenir.",
      "Je m'impatiente lors de conférences ou de discussions.",
      "J'aime les casse-têtes.",
      "Je fais des projets pour l'avenir."
    ];

    const reversedItems = [1,7,8,9,10,12,13,15,20,29,30]; // inversées
    const choices = [
      "Rarement / Jamais",
      "Occasionnellement",
      "Souvent",
      "Presque toujours"
    ];

    const container = document.getElementById("questions");
    questions.forEach((q, idx) => {
      const div = document.createElement("div");
      div.classList.add("question-block");
      div.innerHTML = `<h3>${idx + 1}. ${q}</h3>` +
        choices.map((choice, i) =>
          `<label><input type="radio" name="q${idx}" value="${i + 1}"> ${choice}</label>`
        ).join("");
      container.appendChild(div);
    });

    function generateCSV() {
      const id = document.getElementById("identifiant").value.trim();
      if (!id) {
        alert("Veuillez renseigner l'identifiant patient.");
        return;
      }

      let csv = `Identifiant;${id}\nNuméro;Question;Réponse\n`;

      questions.forEach((q, idx) => {
        const radios = document.getElementsByName(`q${idx}`);
        let selected = "Non répondu";
        radios.forEach(r => { if (r.checked) selected = r.value; });

        if (selected !== "Non répondu" && reversedItems.includes(idx + 1)) {
          selected = 5 - selected; // inversion échelle 1–4
        }

        csv += `"${idx + 1}";"${q}";"${selected}"\n`;
      });

      const BOM = "\uFEFF";
      const blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `${id}_BIS11_resultats.csv`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>
</body>
</html>
