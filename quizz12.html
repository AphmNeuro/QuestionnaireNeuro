<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Échelle FNM V5 ON-OFF</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 30px;
      background-color: #54A9AE;
      text-align: center;
      color: #2c3e50;
    }
    h1 {
      margin-bottom: 20px;
    }
    .identifiant {
      background: #e0e0e0;
      padding: 15px 25px;
      border-radius: 12px;
      text-align: left;
      max-width: 900px;
      margin: 0 auto 30px;
    }
    .identifiant label { font-weight: bold; }
    .identifiant input {
      width: 300px;
      padding: 8px;
      margin-top: 5px;
    }
    .question-block {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      padding: 25px 30px;
      margin: 30px auto;
      max-width: 900px;
      text-align: left;
    }
    .slider-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 15px;
    }
    .slider-container span {
      width: 150px;
      font-size: 14px;
    }
    input[type="range"] {
      flex: 1;
      margin: 0 15px;
    }
    .ticks {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      padding: 0 165px;
    }
    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 30px;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #2980b9;
    }
    .retour {
      position: absolute;
      top: 20px;
      left: 20px;
    }
    .retour a {
      text-decoration: none;
      color: #ffffff;
      background-color: #2c3e50;
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 14px;
      transition: background-color 0.3s ease;
    }
    .retour a:hover {
      background-color: #1a242f;
    }
  </style>
</head>
<body>
  <div class="retour">
    <a href="index.html">← Retour</a>
  </div>

  <h1>Échelle FNM V5 ON-OFF</h1>

  <div class="identifiant">
    <label for="identifiant">Identifiant Patient :</label>
    <input type="text" id="identifiant" placeholder="Ex : ABC456">
  </div>

  <form id="fnmForm">
    <div id="questions"></div>
    <button type="button" onclick="generateCSV()">Télécharger en CSV</button>
  </form>

  <script>
    const questions = [
      {text: "Transpiration", left: "Je transpire normalement", right: "J’ai des sueurs abondantes"},
      {text: "Salive", left: "Je salive normalement", right: "J’ai beaucoup de salive"},
      {text: "Déglutition", left: "Je déglutis normalement", right: "J’ai beaucoup de difficultés à avaler"},
      {text: "Élocution", left: "Je parle normalement", right: "On ne comprend pas du tout ce que je dis"},
      {text: "Écriture", left: "J’écris normalement", right: "Je ne peux pas écrire"},
      {text: "Marche", left: "Je marche normalement", right: "Je ne peux pas marcher"},
      {text: "Levers de chaise", left: "Je me lève normalement", right: "Je ne peux pas me lever"},
      {text: "Hygiène", left: "Je fais ma toilette normalement", right: "Je ne peux pas du tout faire ma toilette"},
      {text: "Habillage", left: "Je m’habille normalement", right: "Je ne peux pas du tout m’habiller"},
      {text: "Tremblement", left: "Je n’ai pas de tremblement", right: "J’ai un tremblement permanent"},
      {text: "Rigidité", left: "Je ne suis pas raide", right: "Je suis complètement raide"},
      {text: "Symptômes divers", left: "", right: ""}
    ];

    const container = document.getElementById("questions");
    questions.forEach((q, index) => {
      const div = document.createElement("div");
      div.classList.add("question-block");
      if (index < 11) {
        div.innerHTML = `
          <p>${index + 1}. ${q.text}</p>
          <div class="slider-container">
            <span>${q.left}</span>
            <input type="range" name="q${index}" min="0" max="10" value="5">
            <span>${q.right}</span>
          </div>
          <div class="ticks">${Array.from({length: 11}, (_, i) => `<span>${i}</span>`).join("")}</div>
        `;
      } else {
        div.innerHTML = `
          <p>12. Symptômes divers (respiration, tristesse, problèmes urinaires, etc.)</p>
          <textarea name="q${index}" rows="4" style="width:100%;"></textarea>
        `;
      }
      container.appendChild(div);
    });

    function generateCSV() {
      const id = document.getElementById("identifiant").value.trim();
      if (!id) {
        alert("Veuillez renseigner l'identifiant patient avant d’exporter.");
        return;
      }

      let csvContent = `Identifiant;${id}\n\nNuméro;Question;Réponse\n`;
      questions.forEach((q, i) => {
        let selected = "Non répondu";
        if (i < 11) {
          const slider = document.querySelector(`input[name="q${i}"]`);
          selected = slider ? slider.value : "Non répondu";
        } else {
          const txt = document.querySelector(`textarea[name="q${i}"]`).value.trim();
          selected = txt || "Non répondu";
        }
        csvContent += `"${i + 1}";"${q.text}";"${selected}"\n`;
      });

      const BOM = "\uFEFF";
      const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `${id}_FNM_V5_ON_OFF_resultats.csv`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>
</body>
</html>
